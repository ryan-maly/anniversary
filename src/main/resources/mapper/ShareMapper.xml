<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cdc.anniversary.mapper.ShareMapper">
    <select id="getImages" parameterType="int" resultType="String">
        select img from share_img
        where share_id = #{shareid}
    </select>

    <select id="getAllShare" parameterType="int" resultType="com.cdc.anniversary.dto.ShareDTO">
        select s.*, st.is_favor, st.is_collect
        from share s, share_status st
        where  st.share_id = s.id and s.user_id = #{userid}
    </select>

    <select id="getShareByTag" resultType="com.cdc.anniversary.dto.ShareDTO">
        select s.*, st.is_favor, st.is_collect, si.img
        from share s, share_status st, share_img si
        where si.share_id = s.id and st.share_id = s.id and s.tag = #{param1} and s.user_id = #{param2}
    </select>

    <select id="getShareById" resultType="com.cdc.anniversary.dto.ShareDTO">
        select s.*, st.is_favor, st.is_collect, si.img
        from share s, share_status st, share_img si
        where si.share_id = s.id and st.share_id = s.id and s.id = #{param1} and s.user_id = #{param2}
    </select>

    <insert id="addShare" parameterType="Share">
        insert into share(user_id, tag, content, favor_num, collect_num, comment_num, pubdate)
        values (#{user_id}, #{tag}, #{content}, #{favor_num}, #{collect_num}, #{comment_num}, #{pubdate})
    </insert>

    <select id="getMyShare" resultType="com.cdc.anniversary.dto.ShareDTO">
        select s.*, st.is_favor, st.is_collect, si.img
        from share s, share_status st, share_img si
        where si.share_id = s.id and st.share_id = s.id and s.user_id = #{userId}
    </select>
    
    <select id="getFavorNum" parameterType="int" resultType="int">
        select favor_num from share
        where id = #{shareId}
    </select>

    <update id="updateFavorNum">
        update share
        set favor_num = #{param1}
        where id = #{param2}
    </update>

    <select id="getCollectNum" parameterType="int" resultType="int">
        select collect_num from share
        where id = #{shareId}
    </select>

    <update id="updateCollectNum">
        update share
        set collect_num = #{param1}
        where id = #{param2}
    </update>

    <select id="getCommentNum" parameterType="int" resultType="int">
        select comment_num from share
        where id = #{shareId}
    </select>

    <update id="updateCommentNum">
        update share
        set comment_num = #{param2}
        where id = #{param1}
    </update>
</mapper>
